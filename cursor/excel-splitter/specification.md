# 需求

## 配置文件

```yaml config.yaml
input:
  path: "input/项目成本.xlsx"  
  sheet:
    source:
      name: "工资"
      columns:
        employee_id: "工号"
        project_id: "费用所属中心"
        project_category: "费用类别"
        project_hours: "实际出勤"
    reference:
      name: "工时"
      columns:
        employee_id: "工号"
        project_id: "费用所属中心"
        project_category: "费用类别"
        project_hours: "实际出勤"
  splitting_columns:
  - 基本工资
  - 岗位工资
output:
  path: "output/项目成本拆分.xlsx"
  sheet:
    result:
      name: "工资拆分"
```

## 编程规范

- 编写语言为python，要求按python编程规范编写程序
- 默认从配置文件中读取配置，配置文件路径可通过命令行参数设定
- 检查输入文件，如果无法拆分直接退出，并输出无法拆分的原因
- 文件编码方式采用统一采用UTF8

## 数据描述

- 配置文件input.splitting_columns下的键值对表示需要拆分的列，键值对中键为列的标识，值为列的名称
- 配置文件input.sheet..columns下的键值对表示处理过程中涉及到的列，键值对中键为列的标识，值为列的名称，查找列的标识对应的列时需要通过在表中查找列的名称实现

## 数据验证

- 表source中列employee_id必须存在，列project_hours存在与否均可，不过需要确保表result和表source的表头完全一致
- 表source中需要拆分的列必须存在
- 表reference中列employee_id project_id project_category project_hours必须存在

## 拆分规则

- 以表source为基础，参考表reference进行拆分，拆分结果保存到表result中
- 表result与表source列的名称和顺序完全相同
- 表source中列employee_id和表reference中列employee_id是左连接关系，通过列的名称定位列
  - 如果通过employee_id在表reference中找到了对应的记录
    - 列project_id project_category project_hours内容按列名从表reference中获取
    - 配置文件input.splitting_columns中定义的行以表reference中列project-hours为准按比例进行拆分
    - 未在配置文件input.splitting_columns和input.sheet.source.columns中定义的列以表source为准保持不变
    - 表result中拆分后的行的数字格式同表source中拆分前的行
  - 如果通过employee_id在表reference中未找到对应的记录
    - 表source中该行整体复制到表result，包括该行的数字格式

## 测试用例

根据测试用例编写单元测试

### 表头一致

```markdown 表reference
| 姓名 | 工号 | 费用类别 | 费用所属中心 | 实际出勤 |
|------|------|----------|--------------|----------|
```

```markdown 表source
| 姓名 | 工号 | 部门   | 基本工资  | 岗位工资  | 费用类别 | 费用所属中心 | 实际出勤 | 分管领导 |
|------|------|--------|-----------|-----------|----------|--------------|----------|----------|
```

```markdown 表result
| 姓名 | 工号 | 部门   | 基本工资  | 岗位工资 | 费用类别 | 费用所属中心 | 实际出勤 | 分管领导 |
|------|------|--------|-----------|----------|----------|--------------|----------|----------|
```

### 原样复制

```markdown 表reference
| 姓名 | 工号 | 费用类别 | 费用所属中心 | 实际出勤 |
|------|------|----------|--------------|----------|
```

```markdown 表source
| 姓名 | 工号 | 部门   | 基本工资  | 岗位工资  | 费用类别 | 费用所属中心 | 实际出勤 | 分管领导 |
|------|------|--------|-----------|-----------|----------|--------------|----------|----------|
| 张三 | AA   | 中国   | 1000.00   | 3000.00   | 研发     | 研发部       | 21       | BB       |
```

```markdown 表result
| 姓名 | 工号 | 部门   | 基本工资  | 岗位工资 | 费用类别 | 费用所属中心 | 实际出勤 | 分管领导 |
|------|------|--------|-----------|----------|----------|--------------|----------|----------|
| 张三 | AA   | 中国   | 1000.00   | 3000.00   | 研发     | 研发部       | 21       | BB       |
```
### 需要拆分

```markdown 表reference
| 姓名 | 工号 | 费用类别 | 费用所属中心 | 实际出勤 |
|------|------|----------|--------------|----------|
| 张三 | AA   | 研发     | 1            | 1        |
| 张三 | AA   | 研发     | 2            | 4        |
| 张三 | AA   | 销售     | 3            | 4        |
```

```markdown 表source
| 姓名 | 工号 | 部门   | 基本工资  | 岗位工资  | 费用类别 | 费用所属中心 | 实际出勤 | 分管领导 |
|------|------|--------|-----------|-----------|----------|--------------|----------|----------|
| 张三 | AA   | 中国   | 1000.00   | 3000.00   | 研发     | 研发部       | 21       | BB       |
```

```markdown 表result
| 姓名 | 工号 | 部门   | 基本工资  | 岗位工资 | 费用类别 | 费用所属中心 | 实际出勤 | 分管领导 |
|------|------|--------|-----------|----------|----------|--------------|----------|----------|
| 张三 | AA   | 中国   | 111.11    | 33.33    | 研发     | 1            | 1        | BB       |
| 张三 | AA   | 中国   | 444.44    | 133.33   | 研发     | 2            | 4        | BB       |
| 张三 | AA   | 中国   | 444.44    | 133.33   | 销售     | 3            | 4        | BB       |
```
